<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.geometry.Insets?>

<!-- Restore Content Panel - loaded into MainController's content area -->
<VBox xmlns:fx="http://javafx.com/fxml" 
      fx:controller="com.backupforce.ui.RestoreController"
      spacing="0"
      stylesheets="@../css/backupforce-modern.css">
    
    <!-- Page Header -->
    <HBox styleClass="status-bar" spacing="12" alignment="CENTER_LEFT">
        <Label text="Data Restoration" styleClass="page-header-title"/>
        <Region HBox.hgrow="ALWAYS"/>
        <Label fx:id="targetOrgLabel" text="No org connected" styleClass="status-text"/>
    </HBox>
    
    <!-- Main Split -->
    <SplitPane dividerPositions="0.4" VBox.vgrow="ALWAYS" style="-fx-background-color: transparent;">
        
        <!-- LEFT: Source Selection & Objects -->
        <VBox spacing="16" styleClass="content-area">
            
            <!-- Source Type Panel -->
            <VBox spacing="12" styleClass="panel">
                <Label text="Restore Source" styleClass="panel-header"/>
                
                <HBox spacing="20">
                    <RadioButton fx:id="folderSourceRadio" text="Backup Folder" 
                                toggleGroup="$sourceToggle" selected="true" styleClass="form-radio"/>
                    <RadioButton fx:id="databaseSourceRadio" text="Database Connection" 
                                toggleGroup="$sourceToggle" styleClass="form-radio"/>
                </HBox>
                <fx:define>
                    <ToggleGroup fx:id="sourceToggle"/>
                </fx:define>
                
                <!-- Folder Selection -->
                <VBox fx:id="folderSelectionPane" spacing="8">
                    <HBox spacing="10">
                        <TextField fx:id="restoreSourceField" HBox.hgrow="ALWAYS" 
                                  styleClass="form-input" editable="false"
                                  promptText="Select backup folder..."/>
                        <Button fx:id="browseRestoreButton" text="Browse" onAction="#handleBrowseRestore" 
                               styleClass="btn btn-ghost"/>
                    </HBox>
                </VBox>
                
                <!-- Database Selection -->
                <VBox fx:id="databaseSelectionPane" spacing="8" visible="false" managed="false">
                    <ComboBox fx:id="databaseConnectionCombo" maxWidth="Infinity" 
                             promptText="Select database connection..."
                             styleClass="form-combo"/>
                    <Button text="Manage Connections" onAction="#handleManageConnections"
                           styleClass="btn btn-ghost btn-sm"/>
                </VBox>
                
                <Button fx:id="scanSourceButton" text="ðŸ” Scan Source" onAction="#handleScanSource" 
                       styleClass="btn btn-accent"/>
            </VBox>
            
            <!-- Available Objects Panel -->
            <VBox spacing="12" styleClass="panel" VBox.vgrow="ALWAYS">
                <HBox spacing="10" alignment="CENTER_LEFT">
                    <Label text="Available Objects" styleClass="panel-header" style="-fx-padding: 0;"/>
                    <Region HBox.hgrow="ALWAYS"/>
                    <Label fx:id="objectCountLabel" text="0 objects" styleClass="form-hint"/>
                </HBox>
                
                <TextField fx:id="objectSearchField" promptText="ðŸ” Filter objects..." 
                          styleClass="form-input"/>
                
                <HBox spacing="12">
                    <Button text="Select All" onAction="#handleSelectAll" 
                           styleClass="btn btn-ghost btn-sm"/>
                    <Button text="Deselect All" onAction="#handleDeselectAll" 
                           styleClass="btn btn-ghost btn-sm"/>
                </HBox>
                
                <TableView fx:id="objectsTable" VBox.vgrow="ALWAYS" styleClass="data-table">
                    <columns>
                        <TableColumn fx:id="selectColumn" text="" prefWidth="40" minWidth="40" maxWidth="40"/>
                        <TableColumn fx:id="objectNameColumn" text="Object" prefWidth="150"/>
                        <TableColumn fx:id="recordCountColumn" text="Records" prefWidth="80"/>
                        <TableColumn fx:id="lastBackupColumn" text="Backup Date" prefWidth="100"/>
                    </columns>
                    <columnResizePolicy><TableView fx:constant="CONSTRAINED_RESIZE_POLICY"/></columnResizePolicy>
                    <placeholder><Label text="Scan a source to see available objects" styleClass="form-hint"/></placeholder>
                </TableView>
            </VBox>
        </VBox>
    
        <!-- RIGHT: Options & Progress -->
        <ScrollPane fitToWidth="true" style="-fx-background-color: transparent; -fx-background: transparent;">
            <VBox spacing="16" styleClass="content-area">
                
                <!-- Restore Mode Panel -->
                <VBox spacing="12" styleClass="panel">
                    <Label text="Restore Mode" styleClass="panel-header"/>
                    
                    <VBox spacing="10">
                        <RadioButton fx:id="insertOnlyRadio" text="Insert Only (new records)" 
                                    toggleGroup="$restoreModeToggle" selected="true" styleClass="form-radio"/>
                        <VBox spacing="4">
                            <RadioButton fx:id="upsertRadio" text="Upsert (insert or update)" 
                                        toggleGroup="$restoreModeToggle" styleClass="form-radio"/>
                            <HBox spacing="8" alignment="CENTER_LEFT" style="-fx-padding: 0 0 0 24;">
                                <Label text="External ID Field:" styleClass="form-hint"/>
                                <ComboBox fx:id="externalIdFieldCombo" prefWidth="150" styleClass="form-combo" 
                                         disable="true" promptText="Select field"/>
                            </HBox>
                        </VBox>
                        <RadioButton fx:id="updateOnlyRadio" text="Update Only (existing records)" 
                                    toggleGroup="$restoreModeToggle" styleClass="form-radio"/>
                    </VBox>
                    <fx:define>
                        <ToggleGroup fx:id="restoreModeToggle"/>
                    </fx:define>
                </VBox>
                
                <!-- Options Panel -->
                <VBox spacing="12" styleClass="panel">
                    <Label text="Options" styleClass="panel-header"/>
                    
                    <CheckBox fx:id="validateBeforeRestoreCheck" text="Validate data before restore" 
                             selected="true" styleClass="form-checkbox"/>
                    <CheckBox fx:id="stopOnErrorCheck" text="Stop on first error" 
                             styleClass="form-checkbox"/>
                    <CheckBox fx:id="preserveIdsCheck" text="Preserve original Salesforce IDs" 
                             styleClass="form-checkbox"/>
                    <CheckBox fx:id="dryRunCheck" text="ðŸ” Dry Run (preview only, no changes)" 
                             styleClass="form-checkbox" style="-fx-text-fill: #58a6ff;"/>
                    
                    <HBox spacing="10" alignment="CENTER_LEFT">
                        <Label text="Batch Size:" styleClass="form-label"/>
                        <ComboBox fx:id="batchSizeCombo" prefWidth="100" styleClass="form-combo"/>
                    </HBox>
                </VBox>
                
                <!-- Transformation Panel -->
                <VBox spacing="10" styleClass="panel">
                    <HBox spacing="10" alignment="CENTER_LEFT">
                        <Label text="Cross-Org Transformation" styleClass="panel-header" style="-fx-padding: 0;"/>
                        <Region HBox.hgrow="ALWAYS"/>
                        <Label fx:id="transformStatusLabel" text="Not configured" styleClass="form-hint"/>
                    </HBox>
                    <Label text="Map RecordTypes, picklists, and users between different orgs" 
                           styleClass="form-hint"/>
                    <HBox spacing="10">
                        <Button fx:id="configureTransformButton" text="Configure Mappings" 
                               onAction="#handleConfigureTransformations" styleClass="btn btn-ghost btn-sm"/>
                        <Button fx:id="loadTransformButton" text="Load Config" 
                               onAction="#handleLoadTransformConfig" styleClass="btn btn-ghost btn-sm"/>
                    </HBox>
                </VBox>
                
                <!-- Warning Callout -->
                <VBox styleClass="callout callout-warning" spacing="8">
                    <Label text="âš ï¸ Important" styleClass="callout-title"/>
                    <Label text="Data will be inserted/updated in your connected Salesforce org. Use Dry Run first to preview changes." 
                           styleClass="callout-text" wrapText="true"/>
                </VBox>
                
                <!-- Action Buttons -->
                <HBox spacing="12" alignment="CENTER">
                    <Button fx:id="startRestoreButton" text="â–¶ Start Restore" onAction="#handleStartRestore" 
                           styleClass="btn btn-accent btn-lg" disable="true" HBox.hgrow="ALWAYS" maxWidth="Infinity"/>
                    <Button fx:id="stopRestoreButton" text="Stop" onAction="#handleStopRestore" 
                           styleClass="btn btn-danger" disable="true"/>
                </HBox>
                
                <!-- Progress Panel -->
                <VBox spacing="12" styleClass="panel" VBox.vgrow="ALWAYS">
                    <HBox spacing="10" alignment="CENTER_LEFT">
                        <Label text="Restore Progress" styleClass="panel-header" style="-fx-padding: 0;"/>
                        <Region HBox.hgrow="ALWAYS"/>
                        <Label fx:id="progressPercentLabel" text="0%" 
                               style="-fx-font-size: 18px; -fx-font-weight: 700; -fx-text-fill: #3fb950;"/>
                    </HBox>
                    
                    <ProgressBar fx:id="progressBar" maxWidth="Infinity" prefHeight="8" progress="0"
                                styleClass="progress-bar-success"/>
                    
                    <HBox spacing="20">
                        <Label fx:id="currentObjectLabel" text="Ready" styleClass="form-hint"/>
                        <Region HBox.hgrow="ALWAYS"/>
                        <Label fx:id="recordsProcessedLabel" text="0 / 0 records" styleClass="form-hint"/>
                    </HBox>
                    
                    <Label text="Activity Log" styleClass="form-label"/>
                    <TextArea fx:id="logArea" VBox.vgrow="ALWAYS" editable="false" wrapText="true"
                             styleClass="log-area" prefHeight="120"/>
                </VBox>
                
            </VBox>
        </ScrollPane>
        
    </SplitPane>
</VBox>